
<% widget=locals[:widget] %>
<% if widget.feed %>
<div id="container_<%= widget.id -%>" style="min-width: 130px; height: 140px; margin: 0 auto">

<script>
$(function () {
    var tmp=Widget.widgets["<%= widget.id %>"];
    tmp.options={
            chart:{
                renderTo:'container_<%= widget.id -%>'
            },
            title:{
                text:null
            },
            yAxis: {
                title: {
                    text: '<%= widget.feed.name -%>'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: 'Â°C'
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                id:1,
                name: '<%= widget.feed.name -%>',
                data: [<%= widget.feed.measures[-10..-1].map{|v| v.value}.join(',') -%>]
            }]
        };
//    tmp.chart=$('#container_<%= widget.id -%>').highcharts(tmp.options);
       tmp.chart=new Highcharts.Chart(tmp.options);
    });
    
{
    var tmp=Widget.widgets["<%= widget.id %>"];
    tmp.on_update=function(message){
        this.chart.series[0].addPoint(message.data.value)
    }
    tmp_<%= widget.id -%>=tmp;
}

 </script>
 <% else %>
 Widget not linked to a feed 
 <% end %>